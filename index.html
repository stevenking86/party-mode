<!doctype html>
<html>
  <head>
    <title>Party Mode</title>
    <link rel="stylesheet" href="index.css">
    <link href="https://fonts.googleapis.com/css?family=Satisfy" rel="stylesheet">
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.145.0.min.js"></script>
    <script type='text/javascript' src='hue.js'></script>
    <script type='text/javascript' src='aws.js'></script>
    <script type='text/javascript' src='Microphone.js'></script>

  </head>
    <div class="header">
      <h1>Welcome to Party Mode</h1>
      <h2>We'll kindly ask for access to your microphone before we begin the show.</h2>
      <p>Please enter your hue API.<span><a href="https://www.meethue.com/api/nupnp" target="_blank">Get it!</a></span></p>
      <input id="hueIP" type="text" name="firstname" placeholder="000.000.000.">
    <div>


  <body>
    <script>
    var Mic = new Microphone();

    var avgCounter = 0;
    var volumes = [];
    var numLights = 0;
    var hueIp = null;

    setInterval(function() {
        hueIp = document.getElementById("hueIP").value;

        if (hueIp) {
            getNumLights(hueIp, numLights, function(lights) {
                numLights = lights;
                updateLights(Mic.soundValues());
            })
        }
    }, 100);

    function updateCategorically(values) {
        for (var i = 0; i < numLights; i++) {
            if (i % 3 === 1) {
                updateLight("highs", 1, values.highs, values.vol, hueIp);
            } else if (i % 3 === 2) {
                updateLight("mids", 2, values.mids, values.vol, hueIp);
            } else if (i % 3 === 0) {
                updateLight("bass", 3, values.bass, values.vol, hueIp);
            }
        }
    }

    function updateLights(values) {
        if (avgCounter <= 2) {
            avgCounter += 1;
            volumes.push(values.vol)
        } else {
            values.vol = Math.round((volumes[0] + volumes[1] + volumes[2]) / 3);

            // console.log(values);

            avgCounter = 0;
            volumes = [];

            updateCategorically(values);
            sendKinesisData(values);
        }
    }
    </script>
  </body>
</html>
